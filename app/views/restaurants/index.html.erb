<h3>Restaurants</h3>

<%= link_to "Add New", new_restaurant_path %>

<div class="container">
  <table>
  <% if @restaurants %>
    <tr>
      <th>Name</th>
      <th>Category</th>
      <th>Average</th>
      <th>Your Rating</th>
      <th>Last Visited</th>
    </tr>
    <% @restaurants.each do |restaurant|%>
      <tr>
        <td><%= restaurant.name %></td>
        <td><%= restaurant.category %></td>
        <td><%= restaurant.average %></td>
        <% if logged_in? %>
          <% if my_rating = current_user.rating(restaurant.id) %>
            <td><%= link_to my_rating, edit_rating_path(id: restaurant.id) %></td>
          <% else %>
            <td><%= link_to 'Rate it!', new_rating_path %></td>
          <% end %>
        <% else %>
          <td><%= link_to 'Login', login_path %></td>
        <% end %>
        <td><%= restaurant.last_visited ? restaurant.last_visited.strftime("%b %-d, %Y") : nil  %></td>
      </tr>
    <% end %>
  <% end %>
  </table>
</div>